<div class="container" id="doc-container">
    <div class="row">
        <div class="col-md-9 col-xs-12" id="doc-content">
            <h2 id="getting-started">Getting Started</h2>
            <hr>

            <p>All the tools you need to get started:</p>
            <ol>
                <li><a href="https://nodejs.org/">Node.js</a> - Server-side JavaScript environment</li>
                <li><a href="https://www.mongodb.org/">MongoDB</a> - A NoSQL database</li>
                <li><a href="https://www.npmjs.com/">npm</a> - Node Package Manager</li>
                <li><a href="https://www.npmjs.com/package/nodemon">nodemon</a> - A monitor script that restarts a node.js
                    application whenever changes are detected</li>
            </ol>

            <blockquote>
                <p><strong>Note</strong>: <code>nodemon</code> can only be installed once you have installed <code>npm</code>.</p>
            </blockquote>

            <p>Once you have installed the above tools, you need to clone the repository,
                and execute the following command from the <code>app</code> directory to install
                all the server-side dependencies (listed in <code>app/package.json</code>) in one go:</p>
            <pre>$ npm install</pre>

            <p>Now that all dependencies have been installed, you can start a MongoDB server by executing the following command:</p>
            <pre>$ mongod --dbpath data/</pre>

            <blockquote>
                <strong>Note: </strong> You need to manually create an empty <code>data</code> directory within the
                <code>app</code> directory. This is where all the database content will be stored.
            </blockquote>

            <p>
                Now, the entire client-side JavaScript code (which has been divided into separate Require.js modules)
                needs to be combined together into a single file (minified and uglified) <code>app/public/javascripts/build/main.min.js</code>.
                This can be done using the provided Require.js optimizer (<code>app/public/javascripts/libs/r.js</code>), by executing the following
                command:
            </p>
            <pre>$ node public/javascripts/libs/r.js -o name=main out=public/javascripts/build/main.min.js mainConfigFile=public/javascripts/main.js include=libs/require.js</pre>

            <p>And finally, the application can be started with the following command:</p>
            <pre>$ nodemon</pre>

            <blockquote>
                <p><strong>Note</strong>: All the above commands must be executed from the <code>app</code> directory.
            </blockquote>

            <p>After executing the above two scripts (in any order you like), you can start exploring the tool
                by visiting the following URL in your preferred browser:</p>
            <pre>localhost:3000</pre>
            <blockquote>
                <p><strong>Note</strong>: If you wish to change the above port number, simply modify the <code>port</code>
                    variable found in <code>app/bin/www</code>, according to your liking.</p>
            </blockquote>

            <br>
            <!----------------------------------------->

            <h2 id="dependencies">Dependencies</h2>
            <hr>

            <p>
                All server-side dependencies are included in <code>app/package.json</code>, while all
                client-side dependencies are included in <code>app/public/javascripts/libs</code> as JavaScript files.
                The usage of each of these dependencies is briefly described below:
            </p>

            <strong>Server-side dependencies:</strong>
            <ul>
                <li><a href="https://www.npmjs.com/package/async">async</a> - Eases asynchronous control flow</li>
                <li><a href="https://www.npmjs.com/package/body-parser">body-parser</a> - POST data parsing middleware</li>
                <li><a href="https://www.npmjs.com/package/cookie-parser">cookie-parser</a> - Cookie header parsing middleware</li>
                <li><a href="https://www.npmjs.com/package/express">express</a> - Server-side web application framework</li>
                <li><a href="https://www.npmjs.com/package/mongoose">mongoose</a> - Object Document Model (ODM) for MongoDB</li>
                <li><a href="https://www.npmjs.com/package/morgan">morgan</a> - HTTP request logger middleware</li>
                <li><a href="https://www.npmjs.com/package/serve-favicon">serve-favicon</a> - Favicon serving middleware</li>
                <li><a href="https://www.npmjs.com/package/swig">swig</a> - Template engine</li>
            </ul>

            <strong>Client-side dependencies:</strong>
            <ul>
                <li><a href="http://backbonejs.org">backbone-min.js</a> - Library for developing single-page applications</li>
                <li><a href="http://getbootstrap.com">bootstrap.min.js</a> - Javascript component of Bootstrap framework</li>
                <li><a href="https://eonasdan.github.io/bootstrap-datetimepicker/">bootstrap-datetimepicker.min.js</a>Date/Time picker for Bootstrap</li>
                <li><a href="https://github.com/terikon/marker-animate-unobtrusive/tree/master/vendor">jquery.easing.1.3.min</a> - Dependency for SlidingMarker.js</li>
                <li><a href="https://jquery.com/">jquery-2.1.4.min.js</a> - Simplifies client-side scripting of HTML</li>
                <li><a href="https://github.com/terikon/marker-animate-unobtrusive/tree/master/vendor">markerAnimate.js</a> - Dependency for SlidingMarker.js</li>
                <li><a href="http://momentjs.com/">moment-with-locales.min.js</a> - Date library for parsing, manipulating and displaying dates</li>
                <li><a href="http://momentjs.com/timezone/">moment-timezone-with-data.js</a> - Date library for parsing, manipulating and displaying dates (includes time zones)</li>
                <li><a href="http://requirejs.org/docs/optimization.html">r.js</a> - Used for multiple Require.js modules into a single file</li>
                <li><a href="http://requirejs.org/">require.js</a> - Javascript file and module loader</li>
                <li><a href="https://github.com/terikon/marker-animate-unobtrusive">SlidingMarker.js</a> - Used for animating markers on Google map</li>
                <li><a href="http://paularmstrong.github.io/swig/">swig.min.js</a> - Template engine</li>
                <li><a href="http://requirejs.org/docs/download.html#plugins">text.js</a> - Require.js plugin for loading templates</li>
                <li><a href="http://underscorejs.org/">underscore-min.js</a> - Provides useful functional programming helpers</li>
            </ul>

            <blockquote>
                <strong>Note: </strong> Even though <code>moment-timezone-with-data.js</code> is a superset of
                <code>moment-with-locales.min.js</code>, they are both needed since <code>moment-with-locales.min.js</code>
                is a strict dependency of <code>bootstrap-datetimepicker.min.js</code>.
            </blockquote>

            <br>
            <!----------------------------------------->

            <h2 id="project-structure">Project Structure</h2>
            <hr>

            <p>When you first clone the repository, <code>app</code> directory structure would look like this:</p>
            <pre>
app/
 |-- bin/
 |-- models/
 |-- node_modules/ (will be created after you execute 'npm install')
 |-- public/
 |-- routes/
 |-- utils/
 |-- views/
 |-- app.js
 |-- package.json
            </pre>

            <p>These files/directories are:</p>
            <ul>
                <li>
                    <code>bin/</code> serves as a location where you can define your various start up scripts.
                </li>
                <li>
                    <code>models/</code> consists of all the ODM models (Mongoose schemas).
                </li>
                <li>
                    <code>node_modules/</code> consists of all the dependencies installed using npm.
                </li>
                <li>
                    <code>public/</code>  consists of all the static files served by the web app (i.e. JavaScripts,
                    CSS stylesheets, HTML templates, images and fonts).
                </li>
                <li>
                    <code>routes/</code> consists of all route files. A route file consists of functions that
                    generate HTTP responses based on the requests received. These responses could be for example an
                    HTML template (<code>routes/index.js</code>) or simply JSON (<code>routes/api.js</code>).
                </li>
                <li>
                    <code>utils/</code> consists of database population/configuration scripts.
                </li>
                <li>
                    <code>views/</code> consists of HTML templates that are accessed directly by route functions
                    (<code>routes/</code>).
                </li>
                <li>
                    <code>app.js</code> is the nain configuration file for the <code>express.js</code> app.
                </li>
                <li>
                    <code>package.json</code> is used to give information to npm that allows it to identify the
                    project as well as handle the project's dependencies.
                </li>
            </ul>
            <br>
            <!----------------------------------------->

            <h2 id="client-side-javascript-structure">Client-side JavaScript Structure</h2>
            <hr>

            <p><code>Backbone.js</code> has been used to develop the client-side single-page application. The code is
                structured into multiple modules using <code>Require.js</code> as follows: </p>

            <pre>
javascripts/
 |-- build/
      |-- main.min.js (will be created when you use Require.js optimizer to combine all modules)
 |-- collections/
      |-- all_vehicles.js
      |-- services.js
      |-- unique_vehicles.js
 |-- libs/
      |-- ... (listed under 'Dependencies -> Client-side dependencies' section)
 |-- models/
      |-- service.js
      |-- vehicle.js
 |-- views/
      |-- configure_controls_modal.js
      |-- control_panel.js
      |-- doc.js
      |-- legend_disabled_confirmation_modal.js
      |-- map.js
      |-- map_controls.js
      |-- nav.js
      |-- select_services_modal.js
      |-- select_time_span_modal.js
      |-- select_vehicles_modal.js
      |-- service_item.js
      |-- snackbar.js
      |-- tool.js
      |-- vehicle_item.js
 |-- main.js
 |-- router.js
            </pre>

            <p>These files/directories are:</p>

            <ul>
                <li>
                    <code>build/</code> consists of the minified and uglified JavaScript file, which includes all the
                    required modules.
                </li>
                <li>
                    <code>collections/</code> consists of Backbone.js collections. Collections are nothing but ordered
                    sets of models.
                    <ul>
                        <li>
                            <code>all_vehicles.js</code> is a collection of all vehicles returned by the server when the
                            user clicks on submit button in the control panel. The models in this collection are used to
                            display markers on the map.
                        </li>
                        <li>
                            <code>services.js</code> is a collection of all services stored in the database. The models
                            in this collection are used to display services in 'Select services' modal.
                        </li>
                        <li>
                            <code>unique_vehicles.js</code> is a collection of vehicles with unique vehicle IDs,
                            corresponding to the services selected by the user.
                        </li>
                    </ul>
                </li>
                <li>
                    <code>libs/</code> consists of all client-side dependencies (as listed under 'Dependencies -> client-
                    side dependencies' section).
                </li>
                <li>
                    <code>models/</code> consists of the actual data models that collections are made of. They basically
                    correspond to the Mongoose schemas on the server-side (in <code>app/models/</code>).
                    <ul>
                        <li>
                            <code>service.js</code> is the data model of which <code>services.js</code>
                            collection is comprised of.
                        </li>
                        <li>
                            <code>vehicle.js</code> is the dat model which <code>all_vehicles</code> and
                            <code>unique_vehicles</code> collections are comprised of.
                        </li>
                    </ul>
                </li>
                <li>
                    <code>views/</code> consists of view files that represent the various parts/sections of the user
                    interface.
                    <ul>
                        <li>
                            <code>configure_controls_modal.js</code> represents the modal that is used to configure the
                            step sizes of the simulation controls. This model is displayed whenever the user clicks on
                            'Configure' at the top right corner of the map control panel.
                        </li>
                        <li>
                            <code>controls_panel.js</code> represents the sliding control panel that is used to select
                            services, vehicles and the time span for the simulation. It also allows the user to switch to
                            live simulation mode. Its visiblity can be toggled via the 'Control Panel' button that appears
                            just under the top navigation bar.
                        </li>
                        <li>
                            <code>doc.js</code> represents the documentation page. It basically handles the the navigation
                            sidebar that indicates which section of the documentation the user is currently viewing.
                            This page can be displayed by clicking on the 'Documentation' tab on the
                            navigation bar, or by changing the URL to <code>/doc</code>.
                        </li>
                        <li>
                            <code>legend_disabled_confirmation_modal.js</code> represents the modal that is displayed as
                            a warning message whenever the user selects more services than the maximum number of marker icons
                            available.
                        </li>
                        <li>
                            <code>map.js</code> represents the Google map. It provides methods to draw markers and
                            polylines on the map. These methods are invoked by <code>map_controls.js</code>.
                        </li>
                        <li>
                            <code>map_controls.js</code> represents the simulation control panel. It basically handles
                            the entire simulation, and sends messages to <code>map.js</code> whenever it needs something to
                            be drawn on the map.
                        </li>
                        <li>
                            <code>nav.js</code> represents the navigation bar that appears at the top of the page. It
                            basically handles that navigation tabs.
                        </li>
                        <li>
                            <code>select_services_modal.js</code> represents the modal that allows the user to select
                            the services they would like to view the vehicles of.
                        </li>
                        <li>
                            <code>select_time_span_modal.js</code> represents the modal that allows the user to select
                            time span for the simulation.
                        </li>
                        <li>
                            <code>select_vehicles_modal.js</code> represents the modal that allows the user to select
                            the vehicles they would like to view the simulation of.
                        </li>
                        <li>
                            <code>service_item.js</code> represents a single list item displyed in 'Select services'
                            modal. It handles the selection of an individual service, as well as displaying a popover to
                            view the description of that service.
                        </li>
                        <li>
                            <code>snackbar.js</code> represents the alert message that is displayed at the bottom right
                            corner of the screen. It is used throught the application to display hint and error messages.
                        </li>
                        <li>
                            <code>tool.js</code> represents the tool page. It handles the rendering of all of its sub-views.
                        </li>
                        <li>
                            <code>vehicle_item.js</code> represents a single list item displayed in 'Select vehicles' modal.
                            It handles the selection of an individual vehicle, as well as displaying a popover to view all
                            services served by that vehicle.
                        </li>
                    </ul>
                </li>
                <li>
                    <code>main.js</code> is the main <code>Require.js</code> configuration file. This is also the main
                    entry point of the application.
                </li>
                <li>
                    <code>router.js</code> is where the routes are defined. It also exposes the app initialization function
                    <code>init</code> which is invoked from <code>main.js</code>.
                </li>
            </ul>

            <blockquote>
                <strong>Note</strong>: You might have noticed the use of <code>require</code> to create a module in
                <code>main.js</code>, instead of using <code>define</code>. Here's why:
                <ul>
                    <li>
                        Use <code>define</code> if you want to declare a module other parts of your application depend
                        on.
                    </li>
                    <li>
                        Use <code>require</code> if just want to load and use other modules.
                    </li>
                </ul>

            </blockquote>

            <br>
            <!----------------------------------------->

            <h2 id="database-population">Database Population</h2>
            <hr>

            <p>
                The command line script (<code>db_population.js</code>) for populating the database is included in
                <code>utils/</code> directory. It can be run using the following command:
            </p>

            <pre>$ node db_population.js &lt;argument&gt;</pre>

            <p>The following command-line arguments are allowed:</p>
            <ul>
                <li>
                    <code>live</code> populates the VehicleLocation collection at regular
                    intervals of 40 seconds. It can be manually stopped by pressing <kbd>Ctrl + C</kbd>.
                </li>
                <li>
                    <code>nonlive</code> first empties the Stop and Service collections, and then repopulates them with
                    the latest data fetched from the TFE API.
                </li>
                <li>
                    <code>vehicle_to_services</code> first empties the VehicleToServices collection, and then repopulates
                    it using the existing Stop and Service collections.
                </li>
            </ul>

            <p>If any other arguments are supplied to this script, it will print an error message and immediately exit.</p>

            <br>
            <!----------------------------------------->
        </div>
        <div class="col-md-3 visible-lg visible-md">
            <ul class="list-group" id="doc-sidebar">
                <li class="list-group-item sidebar-item active" data-target="#getting-started">Getting Started</li>
                <li class="list-group-item sidebar-item" data-target="#dependencies">Dependencies</li>
                <li class="list-group-item sidebar-item" data-target="#project-structure">Project Structure</li>
                <li class="list-group-item sidebar-item" data-target="#client-side-javascript-structure">Client-side JavaScript Structure</li>
                <li class="list-group-item sidebar-item" data-target="#database-population">Database Population</li>
            </ul>
        </div>
    </div>
    <div class="row">
        <hr>
        <div class="col-md-6 col-xs-6">
            <p>Developed by <a href="mailto: manas.bajaj94@gmail.com">Manas Bajaj</a></p>
        </div>
        <div class="col-md-6 col-xs-6 text-right">
            <p>Hosted on <a href="https://bitbucket.org/enthusiast94/quanticol-visualisation-tool">Bitbucket</a></p>
        </div>
    </div>
</div>